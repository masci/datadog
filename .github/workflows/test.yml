name: "build-test"
on: 
  pull_request:
    branches:
      - main

jobs:
  # make sure build/ci work properly
  test:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: build and test
      run: |
        npm install
        npm run all

  # make sure the action works on a clean machine without building
  e2e:
    runs-on: ubuntu-latest
    steps:
    - name: checkout
      uses: actions/checkout@v2
    - name: Signalfx
      uses: ./
      with:
        token: ${{ secrets.SIGNALFX_TOKEN }}
        metrics: |
            - type: "counter"
              name: "test.workflow.runtime"
              value: 99
              dimensions: 
                repo: ${{ github.repository }}
            - type: "gauge"
              name: "test.workflow.cpu"
              value: 98.5
            - type: "cumulative_counter"
              name: "test.workflow.executions"
              value: 1
        events: |
          - eventType: 'package-test'
            dimensions: {ci: 'true'}
            properties: {ci: 'true'}
